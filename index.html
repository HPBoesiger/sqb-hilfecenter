<!DOCTYPE html>
<!--
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  MSP-ANWENDUNGEN HILFECENTER                                                 ‚ïë
‚ïë  SQB Systemberater AG                                                        ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  VERSION: 2.5 | DATUM: 2024-12                                               ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  √ÑNDERUNGEN v2.5:                                                            ‚ïë
‚ïë  ‚Ä¢ NEU: Sortierung nach Beliebteste/Neueste/Ge√§ndert                         ‚ïë
‚ïë  ‚Ä¢ NEU: viewCount wird bei jedem Artikel-Klick erh√∂ht                        ‚ïë
‚ïë  ‚Ä¢ Unterst√ºtzt createdAt, updatedAt, viewCount Felder                        ‚ïë
‚ïë  ‚Ä¢ Fallback f√ºr Artikel ohne diese Felder                                    ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  DATENSTRUKTUR (synchronisiert mit Import-Tool v6.11):                       ‚ïë
‚ïë  ‚Ä¢ kategorien[] (ARRAY - Mehrfachauswahl!)                                   ‚ïë
‚ïë  ‚Ä¢ fehlerLoesungen[] (f√ºr FAQ: Problem/Ursache/L√∂sung)                       ‚ïë
‚ïë  ‚Ä¢ weiterfuehrendLinks[] (Titel + URL)                                       ‚ïë
‚ïë  ‚Ä¢ schritte[], stichworte[], produkte[]                                      ‚ïë
‚ïë  ‚Ä¢ createdAt, updatedAt (ISO Timestamp)                                      ‚ïë
‚ïë  ‚Ä¢ viewCount (Integer)                                                       ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  KATEGORIEN (Mehrfachauswahl):                                               ‚ïë
‚ïë  üöÄ Erste Schritte    ‚Üí Einstieg & Grundlagen                                ‚ïë
‚ïë  üìã Anleitungen       ‚Üí Schritt-f√ºr-Schritt Guides                           ‚ïë
‚ïë  üîß Probleml√∂sung     ‚Üí FAQ & Troubleshooting                                ‚ïë
‚ïë  üëÅÔ∏è √úberblick         ‚Üí Produktbeschreibungen                                ‚ïë
‚ïë  ‚öôÔ∏è Einstellungen     ‚Üí Konfiguration & Admin                                ‚ïë
‚ïë  üìö Wissen vertiefen  ‚Üí Vertiefende Dokumentation                            ‚ïë
‚ïë  üí° Praxisbeispiele   ‚Üí Best Practices & Demos                               ‚ïë
‚ïë  üîÑ Flows             ‚Üí Prozessabl√§ufe                                       ‚ïë
‚ïë  üé¨ Videos            ‚Üí Video-Tutorials                                      ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MSP-Anwendungen Hilfecenter</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --sqb-primary: #1a365d;
      --sqb-primary-light: #2c5282;
      --sqb-accent: #ed8936;
      --sqb-accent-light: #f6ad55;
      --sqb-bg: #f7fafc;
      --sqb-card: #ffffff;
      --sqb-text: #1a202c;
      --sqb-text-muted: #718096;
      --sqb-border: #e2e8f0;
      --sqb-success: #38a169;
      --sqb-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --sqb-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--sqb-bg);
      color: var(--sqb-text);
      line-height: 1.6;
    }

    .hilfecenter {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--sqb-primary) 0%, var(--sqb-primary-light) 100%);
      color: white;
      padding: 1.5rem;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 60%;
      height: 200%;
      background: radial-gradient(ellipse, rgba(237, 137, 54, 0.15) 0%, transparent 70%);
      pointer-events: none;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .header-title {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      letter-spacing: -0.02em;
    }

    .header-subtitle {
      font-size: 0.9rem;
      opacity: 0.9;
      font-weight: 400;
    }

    /* Anleitungstext */
    .header-hint {
      margin-top: 0.75rem;
      padding: 0.625rem 0.875rem;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      font-size: 0.8rem;
      opacity: 0.95;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .header-hint svg {
      flex-shrink: 0;
    }

    /* Search Bar */
    .search-container {
      max-width: 1200px;
      margin: -1.25rem auto 0;
      padding: 0 1rem;
      position: relative;
      z-index: 10;
    }

    .search-bar {
      background: var(--sqb-card);
      border-radius: 10px;
      box-shadow: var(--sqb-shadow-lg);
      display: flex;
      align-items: center;
      padding: 0.625rem 1rem;
      gap: 0.75rem;
      border: 2px solid transparent;
      transition: border-color 0.2s ease;
    }

    .search-bar:focus-within {
      border-color: var(--sqb-accent);
    }

    .search-bar svg {
      color: var(--sqb-text-muted);
      flex-shrink: 0;
    }

    .search-input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 0.95rem;
      font-family: inherit;
      color: var(--sqb-text);
      background: transparent;
    }

    .search-input::placeholder {
      color: var(--sqb-text-muted);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem 1rem;
      width: 100%;
    }

    /* Filter Section */
    .filter-section {
      margin-bottom: 1.5rem;
    }

    .filter-group {
      margin-bottom: 0.75rem;
    }

    .filter-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--sqb-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.375rem;
      display: block;
    }

    .filter-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 0.375rem 0.75rem;
      border-radius: 6px;
      border: 1px solid var(--sqb-border);
      background: var(--sqb-card);
      color: var(--sqb-text);
      font-size: 0.8rem;
      font-family: inherit;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
    }

    .filter-btn:hover {
      border-color: var(--sqb-primary);
      color: var(--sqb-primary);
    }

    .filter-btn.active {
      background: var(--sqb-primary);
      border-color: var(--sqb-primary);
      color: white;
    }

    .filter-btn.active-secondary {
      background: var(--sqb-accent);
      border-color: var(--sqb-accent);
      color: white;
    }

    .filter-btn-icon {
      font-size: 0.9rem;
    }

    /* Sort Buttons */
    .sort-group {
      margin-bottom: 0.75rem;
      padding-top: 0.5rem;
      border-top: 1px solid var(--sqb-border);
    }

    .sort-btn {
      padding: 0.375rem 0.75rem;
      border-radius: 6px;
      border: 1px solid var(--sqb-border);
      background: var(--sqb-card);
      color: var(--sqb-text-muted);
      font-size: 0.8rem;
      font-family: inherit;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
    }

    .sort-btn:hover {
      border-color: var(--sqb-primary);
      color: var(--sqb-primary);
    }

    .sort-btn.active {
      background: linear-gradient(135deg, var(--sqb-accent) 0%, var(--sqb-accent-light) 100%);
      border-color: var(--sqb-accent);
      color: white;
    }

    .sort-btn-icon {
      font-size: 0.85rem;
    }

    /* Articles List - Compact View */
    .articles-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .article-row {
      background: var(--sqb-card);
      border-radius: 8px;
      padding: 0.875rem 1rem;
      box-shadow: var(--sqb-shadow);
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid var(--sqb-border);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .article-row:hover {
      transform: translateX(4px);
      box-shadow: var(--sqb-shadow-lg);
      border-color: var(--sqb-accent);
    }

    .article-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--sqb-primary) 0%, var(--sqb-primary-light) 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      flex-shrink: 0;
    }

    /* Kategorie-spezifische Icon-Farben */
    .article-icon.kategorie-erste-schritte {
      background: linear-gradient(135deg, #38a169 0%, #68d391 100%);
    }

    .article-icon.kategorie-anleitungen {
      background: linear-gradient(135deg, #3182ce 0%, #63b3ed 100%);
    }

    .article-icon.kategorie-problemloesung {
      background: linear-gradient(135deg, #e53e3e 0%, #fc8181 100%);
    }

    .article-icon.kategorie-ueberblick {
      background: linear-gradient(135deg, #805ad5 0%, #9f7aea 100%);
    }

    .article-icon.kategorie-einstellungen {
      background: linear-gradient(135deg, #718096 0%, #a0aec0 100%);
    }

    .article-icon.kategorie-wissen-vertiefen {
      background: linear-gradient(135deg, #dd6b20 0%, #ed8936 100%);
    }

    .article-icon.kategorie-praxisbeispiele {
      background: linear-gradient(135deg, #d69e2e 0%, #ecc94b 100%);
    }

    .article-icon.kategorie-flows {
      background: linear-gradient(135deg, #319795 0%, #4fd1c5 100%);
    }

    .article-icon.kategorie-videos {
      background: linear-gradient(135deg, #d53f8c 0%, #ed64a6 100%);
    }

    .article-content {
      flex: 1;
      min-width: 0;
    }

    .article-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--sqb-text);
      margin-bottom: 0.125rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .article-description {
      font-size: 0.8rem;
      color: var(--sqb-text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .article-tags {
      display: flex;
      gap: 0.375rem;
      flex-shrink: 0;
      flex-wrap: wrap;
    }

    .article-tag {
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      background: var(--sqb-bg);
      border-radius: 4px;
      color: var(--sqb-text-muted);
      font-weight: 500;
      white-space: nowrap;
    }

    .article-tag.product {
      background: rgba(237, 137, 54, 0.1);
      color: var(--sqb-accent);
    }

    .article-tag.kategorie {
      background: rgba(26, 54, 93, 0.1);
      color: var(--sqb-primary);
    }

    .article-arrow {
      color: var(--sqb-text-muted);
      flex-shrink: 0;
    }

    /* Article Detail View */
    .article-detail {
      background: var(--sqb-card);
      border-radius: 12px;
      box-shadow: var(--sqb-shadow);
      overflow: hidden;
    }

    .detail-header {
      background: linear-gradient(135deg, var(--sqb-primary) 0%, var(--sqb-primary-light) 100%);
      color: white;
      padding: 1.25rem;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(255, 255, 255, 0.15);
      border: none;
      color: white;
      padding: 0.4rem 0.875rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-family: inherit;
      cursor: pointer;
      margin-bottom: 0.875rem;
      transition: background 0.2s ease;
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    .detail-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.375rem;
    }

    .detail-meta {
      display: flex;
      gap: 0.75rem;
      font-size: 0.8rem;
      opacity: 0.9;
      flex-wrap: wrap;
    }

    .detail-content {
      padding: 1.25rem;
    }

    .detail-description {
      font-size: 0.95rem;
      color: var(--sqb-text-muted);
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--sqb-border);
      white-space: pre-line;
    }

    .open-document-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--sqb-accent);
      color: white;
      padding: 0.75rem 1.25rem;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      text-decoration: none;
      transition: background 0.2s ease;
    }

    .open-document-btn:hover {
      background: var(--sqb-accent-light);
    }

    .steps-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      margin-top: 1.5rem;
      color: var(--sqb-text);
    }

    .step {
      display: flex;
      gap: 0.875rem;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--sqb-border);
    }

    .step:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .step-number {
      width: 28px;
      height: 28px;
      background: var(--sqb-accent);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.8rem;
      flex-shrink: 0;
    }

    .step-text {
      font-size: 0.9rem;
      color: var(--sqb-text);
      line-height: 1.5;
    }

    /* FAQ-Anzeige */
    .faq-item {
      background: var(--sqb-bg);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 3px solid var(--sqb-accent);
    }
    
    .faq-problem {
      color: var(--sqb-text);
      margin-bottom: 0.5rem;
    }
    
    .faq-ursache {
      color: var(--sqb-text-muted);
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }
    
    .faq-loesung {
      color: var(--sqb-text);
      background: rgba(0, 200, 83, 0.1);
      padding: 0.5rem;
      border-radius: 4px;
    }

    /* Funktionen Liste (v2.5) */
    .funktionen-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .funktionen-list li {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.625rem 0.875rem;
      background: linear-gradient(135deg, rgba(237, 137, 54, 0.08) 0%, rgba(237, 137, 54, 0.04) 100%);
      border-left: 3px solid var(--sqb-accent);
      border-radius: 0 6px 6px 0;
      font-size: 0.9rem;
      color: var(--sqb-text);
    }

    .funktionen-list li::before {
      content: '‚úì';
      color: var(--sqb-accent);
      font-weight: 600;
      flex-shrink: 0;
    }

    /* Weiterf√ºhrende Links */
    .detail-links-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .detail-link-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      background: var(--sqb-bg);
      border-radius: 6px;
      color: var(--sqb-text-muted);
    }

    .detail-link-item a {
      color: var(--sqb-accent);
      text-decoration: none;
    }

    .detail-link-item a:hover {
      text-decoration: underline;
    }

    /* Result Count */
    .result-count {
      font-size: 0.8rem;
      color: var(--sqb-text-muted);
      margin-bottom: 0.75rem;
    }

    /* Loading & Empty State */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      padding: 2rem;
      color: var(--sqb-text-muted);
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--sqb-border);
      border-top-color: var(--sqb-accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 2rem;
      color: var(--sqb-text-muted);
    }

    .empty-state svg {
      margin-bottom: 0.75rem;
      opacity: 0.5;
    }

    /* Chat Widget */
    .chat-toggle {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, var(--sqb-accent) 0%, var(--sqb-accent-light) 100%);
      border-radius: 50%;
      border: none;
      color: white;
      cursor: pointer;
      box-shadow: var(--sqb-shadow-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s ease;
      z-index: 1000;
    }

    .chat-toggle:hover {
      transform: scale(1.05);
    }

    .chat-panel {
      position: fixed;
      bottom: 4.5rem;
      right: 1rem;
      width: 340px;
      max-width: calc(100vw - 2rem);
      max-height: 480px;
      background: var(--sqb-card);
      border-radius: 14px;
      box-shadow: var(--sqb-shadow-lg);
      display: none;
      flex-direction: column;
      z-index: 1000;
      overflow: hidden;
    }

    .chat-panel.open {
      display: flex;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chat-header {
      background: linear-gradient(135deg, var(--sqb-primary) 0%, var(--sqb-primary-light) 100%);
      color: white;
      padding: 0.875rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .chat-header-title {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .chat-close {
      background: rgba(255, 255, 255, 0.15);
      border: none;
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-close:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    .chat-messages {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-height: 320px;
    }

    .chat-message {
      padding: 0.75rem 1rem;
      border-radius: 12px;
      font-size: 0.85rem;
      line-height: 1.5;
      max-width: 90%;
    }

    .chat-message.user {
      background: var(--sqb-primary);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }

    .chat-message.assistant {
      background: var(--sqb-bg);
      color: var(--sqb-text);
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }

    .chat-message a {
      color: var(--sqb-accent);
      text-decoration: none;
    }

    .chat-message a:hover {
      text-decoration: underline;
    }

    .chat-input-container {
      display: flex;
      gap: 0.5rem;
      padding: 0.75rem;
      border-top: 1px solid var(--sqb-border);
    }

    .chat-input {
      flex: 1;
      border: 1px solid var(--sqb-border);
      border-radius: 8px;
      padding: 0.625rem 0.875rem;
      font-size: 0.85rem;
      font-family: inherit;
      outline: none;
    }

    .chat-input:focus {
      border-color: var(--sqb-accent);
    }

    .chat-send {
      background: var(--sqb-accent);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease;
    }

    .chat-send:hover {
      background: var(--sqb-accent-light);
    }

    /* Typing Indicator */
    .typing {
      display: flex;
      gap: 4px;
      padding: 0.75rem 1rem;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background: var(--sqb-text-muted);
      border-radius: 50%;
      animation: typingDot 1.4s infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typingDot {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-4px); }
    }

    /* Settings Modal */
    .settings-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .settings-modal.open {
      display: flex;
    }

    .settings-content {
      background: var(--sqb-card);
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      box-shadow: var(--sqb-shadow-lg);
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      border-bottom: 1px solid var(--sqb-border);
    }

    .settings-header h3 {
      font-size: 1rem;
      font-weight: 600;
    }

    .settings-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--sqb-text-muted);
    }

    .settings-body {
      padding: 1rem;
    }

    .settings-body label {
      display: block;
      font-size: 0.8rem;
      font-weight: 500;
      margin-bottom: 0.375rem;
    }

    .settings-body input {
      width: 100%;
      padding: 0.625rem;
      border: 1px solid var(--sqb-border);
      border-radius: 6px;
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
    }

    .settings-hint {
      font-size: 0.75rem;
      color: var(--sqb-text-muted);
      margin-bottom: 0.875rem;
      line-height: 1.4;
    }

    .settings-hint a {
      color: var(--sqb-primary);
    }

    .settings-save {
      width: 100%;
      padding: 0.625rem;
      background: var(--sqb-accent);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
    }

    /* Hide views */
    #detail-view {
      display: none;
    }

    #detail-view.active {
      display: block;
    }

    #list-view.hidden {
      display: none;
    }

    /* Responsive */
    @media (max-width: 640px) {
      .header {
        padding: 1.25rem 1rem;
      }
      
      .header-title {
        font-size: 1.4rem;
      }

      .header-hint {
        font-size: 0.75rem;
        padding: 0.5rem 0.75rem;
      }

      .main-content {
        padding: 1.25rem 0.875rem;
      }

      .article-row {
        flex-wrap: wrap;
      }

      .article-tags {
        width: 100%;
        margin-top: 0.5rem;
        margin-left: 52px;
      }

      .chat-panel {
        width: calc(100% - 1.5rem);
        right: 0.75rem;
        left: 0.75rem;
        bottom: 4rem;
      }

      .chat-toggle {
        width: 46px;
        height: 46px;
        bottom: 0.75rem;
        right: 0.75rem;
      }

      .filter-btn {
        padding: 0.3rem 0.6rem;
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <div class="hilfecenter">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <h1 class="header-title">MSP-Anwendungen Hilfecenter</h1>
        <p class="header-subtitle">Anleitungen, Tipps und Unterst√ºtzung f√ºr alle MS-Portal Anwendungen</p>
        <div class="header-hint">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
          </svg>
          <span>Suche durch Stichworteingaben oder Themenwahl oder gef√ºhrt mit dem Assistenten unten rechts.</span>
        </div>
      </div>
    </header>

    <!-- Suchleiste -->
    <div class="search-container">
      <div class="search-bar">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
        <input type="text" class="search-input" id="search-input" placeholder="Suche im Hilfecenter...">
      </div>
    </div>

    <!-- Hauptinhalt -->
    <main class="main-content">
      <!-- Listenansicht -->
      <div id="list-view">
        <!-- Filter -->
        <div class="filter-section">
          <div class="filter-group">
            <span class="filter-label">Produkt</span>
            <div class="filter-buttons" id="filter-produkte"></div>
          </div>
          <div class="filter-group">
            <span class="filter-label">Thema</span>
            <div class="filter-buttons" id="filter-kategorie"></div>
          </div>
          <div class="filter-group sort-group">
            <span class="filter-label">Sortierung</span>
            <div class="filter-buttons" id="sort-buttons">
              <button class="sort-btn" data-sort="beliebt">
                <span class="sort-btn-icon">üî•</span> Beliebteste
              </button>
              <button class="sort-btn" data-sort="neu">
                <span class="sort-btn-icon">üÜï</span> Neueste
              </button>
              <button class="sort-btn" data-sort="geaendert">
                <span class="sort-btn-icon">‚úèÔ∏è</span> Ge√§ndert
              </button>
            </div>
          </div>
        </div>

        <!-- Ergebnisse -->
        <div class="result-count" id="result-count"></div>

        <!-- Artikel -->
        <div id="articles-container">
          <div class="loading" id="loading">
            <div class="spinner"></div>
            Laden...
          </div>
        </div>
      </div>

      <!-- Detailansicht -->
      <div id="detail-view" class="article-detail">
        <div class="detail-header">
          <button class="back-btn" id="back-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m15 18-6-6 6-6"/>
            </svg>
            Zur√ºck
          </button>
          <h2 class="detail-title" id="detail-title"></h2>
          <div class="detail-meta" id="detail-meta"></div>
        </div>
        <div class="detail-content">
          <p class="detail-description" id="detail-description"></p>
          <a href="#" class="open-document-btn" id="open-document-btn" target="_blank">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
              <polyline points="15 3 21 3 21 9"/>
              <line x1="10" y1="14" x2="21" y2="3"/>
            </svg>
            Anleitung √∂ffnen
          </a>
          <div id="detail-steps"></div>
          <div id="detail-funktionen"></div>
          <div id="detail-links"></div>
        </div>
      </div>
    </main>

    <!-- Chat Toggle -->
    <button class="chat-toggle" id="chat-toggle">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
      </svg>
    </button>

    <!-- Einstellungen Modal -->
    <div class="settings-modal" id="settings-modal">
      <div class="settings-content">
        <div class="settings-header">
          <h3>‚öôÔ∏è Chat Einstellungen</h3>
          <button class="settings-close" id="settings-close">√ó</button>
        </div>
        <div class="settings-body">
          <label for="openai-key">OpenAI API-Key:</label>
          <input type="password" id="openai-key" placeholder="sk-proj-..." />
          <p class="settings-hint">
            Der API-Key wird lokal gespeichert.
            <br>
            <a href="https://platform.openai.com/api-keys" target="_blank">‚Üí API-Key erstellen</a>
          </p>
          <button class="settings-save" id="settings-save">Speichern</button>
        </div>
      </div>
    </div>

    <!-- Chat Panel -->
    <div class="chat-panel" id="chat-panel">
      <div class="chat-header">
        <span class="chat-header-title">üí¨ MSP-Anwendungen Assistent</span>
        <div style="display: flex; gap: 0.375rem;">
          <button class="chat-close" id="chat-settings" title="Einstellungen">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
          </button>
          <button class="chat-close" id="chat-close">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="chat-messages" id="chat-messages">
        <div class="chat-message assistant">
          Willkommen! Wie kann ich Ihnen helfen?
        </div>
      </div>
      <div class="chat-input-container">
        <input type="text" class="chat-input" id="chat-input" placeholder="Ihre Frage...">
        <button class="chat-send" id="chat-send">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // KONFIGURATION
    // ============================================
    const CONFIG = {
      firebase: {
        apiKey: "AIzaSyBHUu8ozRsAyy_1vMQz-WpANTnQgcXMc5B",
        projectId: "risikoanalyse-2025"
      },
      openai: {
        getApiKey: () => localStorage.getItem('sqb_openai_key') || ''
      }
    };

    // KATEGORIEN mit Icons
    const KATEGORIE_CONFIG = {
      'Erste Schritte': { icon: 'üöÄ', class: 'kategorie-erste-schritte' },
      'Anleitungen': { icon: 'üìã', class: 'kategorie-anleitungen' },
      'Probleml√∂sung': { icon: 'üîß', class: 'kategorie-problemloesung' },
      '√úberblick': { icon: 'üëÅÔ∏è', class: 'kategorie-ueberblick' },
      'Einstellungen': { icon: '‚öôÔ∏è', class: 'kategorie-einstellungen' },
      'Wissen vertiefen': { icon: 'üìö', class: 'kategorie-wissen-vertiefen' },
      'Praxisbeispiele': { icon: 'üí°', class: 'kategorie-praxisbeispiele' },
      'Flows': { icon: 'üîÑ', class: 'kategorie-flows' },
      'Videos': { icon: 'üé¨', class: 'kategorie-videos' }
    };

    // ============================================
    // GLOBALE VARIABLEN
    // ============================================
    let articles = [];
    let activeFilters = {
      produkte: [],
      kategorien: []  // Umbenannt von kategorie zu kategorien
    };
    let activeSort = null;  // 'beliebt', 'neu', 'geaendert' oder null
    let chatMessages = [];

    // ============================================
    // DOM ELEMENTE
    // ============================================
    const searchInput = document.getElementById('search-input');
    const filterProdukte = document.getElementById('filter-produkte');
    const filterKategorie = document.getElementById('filter-kategorie');
    const articlesContainer = document.getElementById('articles-container');
    const resultCount = document.getElementById('result-count');
    const loadingEl = document.getElementById('loading');
    const listView = document.getElementById('list-view');
    const detailView = document.getElementById('detail-view');
    const backBtn = document.getElementById('back-btn');
    const chatToggle = document.getElementById('chat-toggle');
    const chatPanel = document.getElementById('chat-panel');
    const chatClose = document.getElementById('chat-close');
    const chatMessagesEl = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const chatSend = document.getElementById('chat-send');

    // ============================================
    // FIREBASE API
    // ============================================
    const firestoreUrl = `https://firestore.googleapis.com/v1/projects/${CONFIG.firebase.projectId}/databases/(default)/documents`;

    async function fetchHilfeArticles() {
      try {
        const response = await fetch(`${firestoreUrl}/hilfecenter?key=${CONFIG.firebase.apiKey}`);
        const data = await response.json();
        
        if (!data.documents) return [];
        
        return data.documents.map(doc => {
          const fields = doc.fields;
          const id = doc.name.split('/').pop();
          
          // KATEGORIEN: Unterst√ºtzt sowohl Array (neu) als auch String (alt)
          let kategorien = [];
          if (fields.kategorien?.arrayValue?.values) {
            // Neues Format: kategorien als Array
            kategorien = fields.kategorien.arrayValue.values.map(v => v.stringValue);
          } else if (fields.kategorie?.stringValue) {
            // Altes Format: kategorie als String - konvertieren zu Array
            kategorien = [fields.kategorie.stringValue];
          }
          
          return {
            id,
            titel: fields.titel?.stringValue || '',
            beschreibung: fields.beschreibung?.stringValue || '',
            kurzbeschreibung: fields.kurzbeschreibung?.stringValue || '',
            produkte: fields.produkte?.arrayValue?.values?.map(v => v.stringValue) || [],
            kategorien: kategorien,  // Jetzt immer ein Array
            zielgruppen: fields.zielgruppen?.arrayValue?.values?.map(v => v.stringValue) || [],
            schritte: fields.schritte?.arrayValue?.values?.map(s => ({
              nr: s.mapValue?.fields?.nr?.integerValue || s.mapValue?.fields?.nr?.stringValue || 0,
              text: s.mapValue?.fields?.text?.stringValue || ''
            })) || [],
            fehlerLoesungen: fields.fehlerLoesungen?.arrayValue?.values?.map(f => ({
              fehler: f.mapValue?.fields?.fehler?.stringValue || '',
              ursache: f.mapValue?.fields?.ursache?.stringValue || '',
              loesung: f.mapValue?.fields?.loesung?.stringValue || ''
            })) || [],
            weiterfuehrendLinks: fields.weiterfuehrendLinks?.arrayValue?.values?.map(l => ({
              titel: l.mapValue?.fields?.titel?.stringValue || '',
              url: l.mapValue?.fields?.url?.stringValue || ''
            })) || [],
            funktionen: fields.funktionen?.arrayValue?.values?.map(v => v.stringValue) || [], // NEU v2.5
            stichworte: fields.stichworte?.arrayValue?.values?.map(v => v.stringValue) || [],
            dokumentPfad: fields.dokumentPfad?.stringValue || '',
            // NEU v2.5: Zeitstempel und Aufrufz√§hler (mit Fallback)
            createdAt: fields.createdAt?.stringValue || null,
            updatedAt: fields.updatedAt?.stringValue || null,
            viewCount: parseInt(fields.viewCount?.integerValue || '0', 10)
          };
        }).filter(a => a.titel && a.titel.trim() !== '');
      } catch (error) {
        console.error('Fehler beim Laden der Artikel:', error);
        throw error;
      }
    }

    // ============================================
    // OPENAI API
    // ============================================
    async function chatWithAssistant(messages) {
      const apiKey = CONFIG.openai.getApiKey();
      
      if (!apiKey) {
        return 'Bitte zuerst den OpenAI API-Key in den Einstellungen hinterlegen (Zahnrad-Symbol).';
      }
      
      // Aktive Filter f√ºr Kontext
      const aktiveFilterInfo = [];
      if (activeFilters.produkte.length > 0) {
        aktiveFilterInfo.push(`Produkte: ${activeFilters.produkte.join(', ')}`);
      }
      if (activeFilters.kategorien.length > 0) {
        aktiveFilterInfo.push(`Themen: ${activeFilters.kategorien.join(', ')}`);
      }
      
      const filterContext = aktiveFilterInfo.length > 0 
        ? `\n\nDER BENUTZER HAT FOLGENDE FILTER AKTIV:\n${aktiveFilterInfo.join('\n')}\nPriorisiere Anleitungen die zu diesen Filtern passen!\n`
        : '';
      
      const artikelDetails = articles.map(a => {
        let info = `## ${a.titel}\n`;
        info += `Produkte: ${a.produkte.join(', ') || 'Alle'}\n`;
        info += `Themen: ${a.kategorien.join(', ') || '-'}\n`;
        if (a.kurzbeschreibung) {
          info += `Kurzbeschreibung: ${a.kurzbeschreibung}\n`;
        }
        if (a.beschreibung) {
          info += `Beschreibung: ${a.beschreibung}\n`;
        }
        if (a.dokumentPfad) {
          info += `Dokument: ${a.dokumentPfad}\n`;
        }
        if (a.schritte && a.schritte.length > 0) {
          info += `Schritte:\n`;
          a.schritte.sort((x, y) => Number(x.nr) - Number(y.nr)).forEach(s => {
            info += `${s.nr}. ${s.text}\n`;
          });
        }
        if (a.fehlerLoesungen && a.fehlerLoesungen.length > 0) {
          info += `Problem & L√∂sung:\n`;
          a.fehlerLoesungen.forEach(f => {
            if (f.fehler) info += `Problem: ${f.fehler}\n`;
            if (f.ursache) info += `Ursache: ${f.ursache}\n`;
            if (f.loesung) info += `L√∂sung: ${f.loesung}\n`;
          });
        }
        return info;
      }).join('\n---\n');
      
      const systemPrompt = `Du bist der MSP-Anwendungen Hilfecenter-Assistent f√ºr MS-Portal Anwendungen.

DEINE AUFGABE:
- Beantworte Fragen KONKRET mit den Informationen aus den Anleitungen
- Gib die relevanten Schritte direkt in deiner Antwort
- Verlinke am Ende auf die passende Anleitung mit einem klickbaren Link
${filterContext}
FORMAT:
- Antworte auf Deutsch, kurz und pr√§zise
- Verwende **fett** f√ºr wichtige Begriffe
- Nummerierte Listen f√ºr Schritte
- Am Ende IMMER einen klickbaren Link im Format: üìñ [Anleitungsname](DokumentURL)
- Wenn kein dokumentPfad vorhanden ist, schreibe nur: üìñ Mehr dazu: Anleitungsname

BEISPIEL f√ºr Link:
üìñ [Zugriff einrichten](https://sqbag.sharepoint.com/sites/Demoportal/Hilfecenter/...)

VERF√úGBARE ANLEITUNGEN:

${artikelDetails}`;

      try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: 'gpt-4.1',
            messages: [
              { role: 'system', content: systemPrompt },
              ...messages
            ],
            max_tokens: 800,
            temperature: 0.5
          })
        });

        const data = await response.json();
        
        if (data.error) {
          if (data.error.code === 'invalid_api_key') {
            return 'Der API-Key ist ung√ºltig. Bitte √ºberpr√ºfen Sie den Key in den Einstellungen.';
          }
          return 'Fehler: ' + data.error.message;
        }
        
        return data.choices?.[0]?.message?.content || 'Keine Antwort erhalten.';
      } catch (error) {
        console.error('Chat-Fehler:', error);
        return 'Verbindungsfehler. Bitte sp√§ter erneut versuchen.';
      }
    }

    // ============================================
    // MARKDOWN RENDERING
    // ============================================
    function renderMarkdown(text) {
      text = text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
      text = text.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
      text = text.replace(/\*([^*]+)\*/g, '<em>$1</em>');
      text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
      text = text.replace(/\n/g, '<br>');
      return text;
    }

    // ============================================
    // RENDER FUNKTIONEN
    // ============================================
    function getUniqueValues(field) {
      const values = new Set();
      articles.forEach(a => {
        if (Array.isArray(a[field])) {
          a[field].forEach(v => values.add(v));
        } else if (a[field]) {
          values.add(a[field]);
        }
      });
      return [...values].sort();
    }

    function renderFilters() {
      const produkte = getUniqueValues('produkte');
      const kategorien = getUniqueValues('kategorien');  // Jetzt aus kategorien Array

      filterProdukte.innerHTML = produkte.map(p => `
        <button class="filter-btn ${activeFilters.produkte.includes(p) ? 'active' : ''}" data-filter="produkte" data-value="${p}">${p}</button>
      `).join('');

      // Kategorien mit Icons
      filterKategorie.innerHTML = kategorien.map(k => {
        const config = KATEGORIE_CONFIG[k] || { icon: 'üìÑ', class: '' };
        return `
          <button class="filter-btn ${activeFilters.kategorien.includes(k) ? 'active-secondary' : ''}" data-filter="kategorien" data-value="${k}">
            <span class="filter-btn-icon">${config.icon}</span> ${k}
          </button>
        `;
      }).join('');

      // Event Listeners
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const filterType = btn.dataset.filter;
          const value = btn.dataset.value;
          
          const index = activeFilters[filterType].indexOf(value);
          if (index > -1) {
            activeFilters[filterType].splice(index, 1);
          } else {
            activeFilters[filterType].push(value);
          }
          
          renderFilters();
          renderArticles();
        });
      });
      
      // Sort Buttons Event Listeners
      initSortButtons();
    }

    function initSortButtons() {
      document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const sortType = btn.dataset.sort;
          
          // Toggle: Wenn bereits aktiv, deaktivieren
          if (activeSort === sortType) {
            activeSort = null;
          } else {
            activeSort = sortType;
          }
          
          // Button-Styles aktualisieren
          document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
          if (activeSort) {
            btn.classList.add('active');
          }
          
          renderArticles();
        });
      });
    }

    function sortArticles(articleList) {
      if (!activeSort) return articleList;
      
      return [...articleList].sort((a, b) => {
        switch (activeSort) {
          case 'beliebt':
            return (b.viewCount || 0) - (a.viewCount || 0);
          case 'neu':
            // Neueste zuerst, Artikel ohne Datum ganz unten
            if (!a.createdAt && !b.createdAt) return 0;
            if (!a.createdAt) return 1;
            if (!b.createdAt) return -1;
            return new Date(b.createdAt) - new Date(a.createdAt);
          case 'geaendert':
            // Zuletzt ge√§ndert zuerst
            if (!a.updatedAt && !b.updatedAt) return 0;
            if (!a.updatedAt) return 1;
            if (!b.updatedAt) return -1;
            return new Date(b.updatedAt) - new Date(a.updatedAt);
          default:
            return 0;
        }
      });
    }

    function renderArticles() {
      const searchQuery = searchInput.value.toLowerCase();
      
      let filtered = articles.filter(article => {
        // Suchfilter (inkl. FAQ-Inhalte und Kategorien)
        const matchesSearch = searchQuery === '' || 
          article.titel.toLowerCase().includes(searchQuery) ||
          article.beschreibung.toLowerCase().includes(searchQuery) ||
          article.kurzbeschreibung.toLowerCase().includes(searchQuery) ||
          article.stichworte.some(s => s.toLowerCase().includes(searchQuery)) ||
          article.kategorien.some(k => k.toLowerCase().includes(searchQuery)) ||
          (article.fehlerLoesungen && article.fehlerLoesungen.some(f => 
            (f.fehler && f.fehler.toLowerCase().includes(searchQuery)) ||
            (f.ursache && f.ursache.toLowerCase().includes(searchQuery)) ||
            (f.loesung && f.loesung.toLowerCase().includes(searchQuery))
          ));
        
        // Produkt-Filter (OR)
        const matchesProdukt = activeFilters.produkte.length === 0 || 
          article.produkte.some(p => activeFilters.produkte.includes(p));
        
        // Kategorie-Filter (OR) - Artikel muss mindestens eine der gefilterten Kategorien haben
        const matchesKategorie = activeFilters.kategorien.length === 0 || 
          article.kategorien.some(k => activeFilters.kategorien.includes(k));
        
        return matchesSearch && matchesProdukt && matchesKategorie;
      });

      // Sortierung anwenden
      filtered = sortArticles(filtered);

      // Ergebnis-Z√§hler
      resultCount.textContent = `${filtered.length} Ergebnis${filtered.length !== 1 ? 'se' : ''}`;

      if (filtered.length === 0) {
        articlesContainer.innerHTML = `
          <div class="empty-state">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
            <p>Keine Artikel gefunden</p>
          </div>
        `;
        return;
      }

      articlesContainer.innerHTML = `
        <div class="articles-list">
          ${filtered.map(article => `
            <div class="article-row" data-id="${article.id}">
              <div class="article-icon ${getKategorieClass(article.kategorien)}">
                ${getKategorieIcon(article.kategorien)}
              </div>
              <div class="article-content">
                <div class="article-title">${article.titel}</div>
                <div class="article-description">${article.kurzbeschreibung || article.beschreibung || ''}</div>
              </div>
              <div class="article-tags">
                ${article.produkte.map(p => `<span class="article-tag product">${p}</span>`).join('')}
                ${article.kategorien.map(k => `<span class="article-tag kategorie">${k}</span>`).join('')}
              </div>
              <div class="article-arrow">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m9 18 6-6-6-6"/>
                </svg>
              </div>
            </div>
          `).join('')}
        </div>
      `;

      // Event Listener f√ºr Zeilen
      articlesContainer.querySelectorAll('.article-row').forEach(row => {
        row.addEventListener('click', () => {
          const article = articles.find(a => a.id === row.dataset.id);
          if (article) {
            // viewCount erh√∂hen
            incrementViewCount(article.id);
            showDetail(article);
          }
        });
      });
    }

    // NEU v2.5: ViewCount in Firebase erh√∂hen
    async function incrementViewCount(articleId) {
      try {
        // Aktuellen Artikel in lokalem Array aktualisieren
        const article = articles.find(a => a.id === articleId);
        if (article) {
          article.viewCount = (article.viewCount || 0) + 1;
        }
        
        // In Firebase aktualisieren via REST API
        const docUrl = `${firestoreUrl}/hilfecenter/${articleId}?key=${CONFIG.firebase.apiKey}&updateMask.fieldPaths=viewCount`;
        await fetch(docUrl, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            fields: {
              viewCount: { integerValue: article.viewCount.toString() }
            }
          })
        });
      } catch (error) {
        console.warn('ViewCount konnte nicht aktualisiert werden:', error);
      }
    }

    // Nimmt jetzt Array entgegen, gibt Klasse der ersten Kategorie zur√ºck
    function getKategorieClass(kategorien) {
      if (!kategorien || kategorien.length === 0) return 'kategorie-anleitungen';
      const firstKategorie = kategorien[0];
      const config = KATEGORIE_CONFIG[firstKategorie];
      return config ? config.class : 'kategorie-anleitungen';
    }

    // Nimmt jetzt Array entgegen, gibt Icon der ersten Kategorie zur√ºck
    function getKategorieIcon(kategorien) {
      if (!kategorien || kategorien.length === 0) return '<span style="font-size: 18px;">üìÑ</span>';
      const firstKategorie = kategorien[0];
      const config = KATEGORIE_CONFIG[firstKategorie];
      const icon = config ? config.icon : 'üìÑ';
      return `<span style="font-size: 18px;">${icon}</span>`;
    }

    function showDetail(article) {
      document.getElementById('detail-title').textContent = article.titel;
      
      // Kurzbeschreibung UND Beschreibung anzeigen
      let descText = '';
      if (article.kurzbeschreibung) {
        descText = article.kurzbeschreibung;
        if (article.beschreibung && article.beschreibung !== article.kurzbeschreibung) {
          descText += '\n\n' + article.beschreibung;
        }
      } else {
        descText = article.beschreibung || '';
      }
      document.getElementById('detail-description').innerText = descText;
      
      // Meta (mit allen Kategorien)
      const metaParts = [];
      if (article.produkte.length) metaParts.push(article.produkte.join(', '));
      if (article.kategorien.length) metaParts.push(article.kategorien.join(', '));
      document.getElementById('detail-meta').innerHTML = metaParts.map(p => `<span>${p}</span>`).join(' ‚Ä¢ ');

      // Dokument-Button
      const docBtn = document.getElementById('open-document-btn');
      if (article.dokumentPfad) {
        docBtn.href = article.dokumentPfad;
        docBtn.style.display = 'inline-flex';
      } else {
        docBtn.style.display = 'none';
      }

      // Schritte
      const stepsContainer = document.getElementById('detail-steps');
      if (article.schritte && article.schritte.length > 0) {
        const sortedSteps = [...article.schritte].sort((a, b) => Number(a.nr) - Number(b.nr));
        
        stepsContainer.innerHTML = `
          <h3 class="steps-title">Kurzanleitung</h3>
          ${sortedSteps.map((schritt, idx) => `
            <div class="step">
              <div class="step-number">${schritt.nr || idx + 1}</div>
              <div class="step-text">${schritt.text}</div>
            </div>
          `).join('')}
        `;
      } else if (article.fehlerLoesungen && article.fehlerLoesungen.length > 0) {
        stepsContainer.innerHTML = `
          <h3 class="steps-title">Problem & L√∂sung</h3>
          ${article.fehlerLoesungen.map(f => `
            <div class="faq-item">
              ${f.fehler ? `<div class="faq-problem"><strong>Problem:</strong> ${f.fehler}</div>` : ''}
              ${f.ursache ? `<div class="faq-ursache"><strong>Ursache:</strong> ${f.ursache}</div>` : ''}
              ${f.loesung ? `<div class="faq-loesung"><strong>L√∂sung:</strong> ${f.loesung}</div>` : ''}
            </div>
          `).join('')}
        `;
      } else {
        stepsContainer.innerHTML = '';
      }

      // NEU v2.5: Funktionen (bei Produktbeschreibungen)
      const funktionenContainer = document.getElementById('detail-funktionen');
      if (article.funktionen && article.funktionen.length > 0) {
        funktionenContainer.innerHTML = `
          <h3 class="steps-title">‚ö° Wichtigste Funktionen</h3>
          <ul class="funktionen-list">
            ${article.funktionen.map(f => `<li>${f}</li>`).join('')}
          </ul>
        `;
      } else {
        funktionenContainer.innerHTML = '';
      }

      // Weiterf√ºhrende Links
      const linksContainer = document.getElementById('detail-links');
      if (article.weiterfuehrendLinks && article.weiterfuehrendLinks.length > 0) {
        linksContainer.innerHTML = `
          <h3 class="steps-title">Weiterf√ºhrende Links</h3>
          <div class="detail-links-list">
            ${article.weiterfuehrendLinks.map(link => `
              <div class="detail-link-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                  <polyline points="15 3 21 3 21 9"/>
                  <line x1="10" y1="14" x2="21" y2="3"/>
                </svg>
                ${link.url 
                  ? `<a href="${link.url}" target="_blank">${link.titel || link.url}</a>`
                  : `<span>${link.titel}</span>`
                }
              </div>
            `).join('')}
          </div>
        `;
      } else {
        linksContainer.innerHTML = '';
      }

      listView.classList.add('hidden');
      detailView.classList.add('active');
    }

    function hideDetail() {
      listView.classList.remove('hidden');
      detailView.classList.remove('active');
    }

    // ============================================
    // CHAT FUNKTIONEN
    // ============================================
    function addChatMessage(role, content) {
      const messageEl = document.createElement('div');
      messageEl.className = `chat-message ${role}`;
      
      if (role === 'assistant') {
        messageEl.innerHTML = renderMarkdown(content);
      } else {
        messageEl.textContent = content;
      }
      
      chatMessagesEl.appendChild(messageEl);
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
    }

    function showTyping() {
      const typingEl = document.createElement('div');
      typingEl.className = 'chat-message assistant typing';
      typingEl.id = 'typing-indicator';
      typingEl.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
      chatMessagesEl.appendChild(typingEl);
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
    }

    function hideTyping() {
      const typingEl = document.getElementById('typing-indicator');
      if (typingEl) typingEl.remove();
    }

    async function sendChatMessage() {
      const message = chatInput.value.trim();
      if (!message) return;

      addChatMessage('user', message);
      chatInput.value = '';
      chatSend.disabled = true;

      chatMessages.push({ role: 'user', content: message });

      showTyping();

      const response = await chatWithAssistant(chatMessages);

      hideTyping();
      addChatMessage('assistant', response);
      chatMessages.push({ role: 'assistant', content: response });

      chatSend.disabled = false;
    }

    // ============================================
    // EVENT LISTENER
    // ============================================
    searchInput.addEventListener('input', renderArticles);
    backBtn.addEventListener('click', hideDetail);
    
    chatToggle.addEventListener('click', () => {
      chatPanel.classList.toggle('open');
    });

    chatClose.addEventListener('click', () => {
      chatPanel.classList.remove('open');
    });

    chatSend.addEventListener('click', sendChatMessage);
    chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') sendChatMessage();
    });

    // Settings Modal
    const settingsModal = document.getElementById('settings-modal');
    const settingsBtn = document.getElementById('chat-settings');
    const settingsClose = document.getElementById('settings-close');
    const settingsSave = document.getElementById('settings-save');
    const openaiKeyInput = document.getElementById('openai-key');

    settingsBtn.addEventListener('click', () => {
      openaiKeyInput.value = CONFIG.openai.getApiKey();
      settingsModal.classList.add('open');
    });

    settingsClose.addEventListener('click', () => {
      settingsModal.classList.remove('open');
    });

    settingsModal.addEventListener('click', (e) => {
      if (e.target === settingsModal) {
        settingsModal.classList.remove('open');
      }
    });

    settingsSave.addEventListener('click', () => {
      const key = openaiKeyInput.value.trim();
      if (key) {
        localStorage.setItem('sqb_openai_key', key);
        settingsModal.classList.remove('open');
        addChatMessage('assistant', 'API-Key gespeichert!');
      }
    });

    // ============================================
    // INITIALISIERUNG
    // ============================================
    async function init() {
      try {
        articles = await fetchHilfeArticles();
        loadingEl.style.display = 'none';
        renderFilters();
        renderArticles();
      } catch (error) {
        loadingEl.innerHTML = `
          <div class="error-state">
            <p><strong>Fehler beim Laden</strong></p>
            <p>${error.message}</p>
            <button onclick="location.reload()">Erneut versuchen</button>
          </div>
        `;
      }
    }

    init();
  </script>
</body>
</html>
